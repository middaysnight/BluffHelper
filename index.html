<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Demon Bluff – Deck Selector & Math (Tabbed, Compact)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0b1220; --panel:#0f172a; --muted:#9ca3af; --line:#223049;
      --text:#e5e7eb; --accent:#60a5fa; --accent2:#a78bfa; --warn:#f59e0b; --ok:#34d399; --bad:#f87171;
      --radius:14px; --gap:12px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    header{padding:14px 16px;border-bottom:1px solid var(--line);background:linear-gradient(180deg,#0e1627,#0c1322)}
    header h1{margin:0;font-size:1rem;letter-spacing:.2px}
    .wrap{display:grid;grid-template-columns:1.6fr .9fr;gap:var(--gap);padding:12px;align-items:start;min-height:calc(100vh - 56px)}
    @media (max-width: 980px){ .wrap{grid-template-columns:1fr;min-height:auto} .deckmath{position:static} }

    /* Left: tabs */
    .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius)}
    .card h2{margin:0;padding:10px 12px;border-bottom:1px solid var(--line);font-size:.95rem;color:#93c5fd}
    .tabs{display:flex;gap:8px;padding:10px 12px;border-bottom:1px solid var(--line);flex-wrap:wrap}
    .tab-btn{padding:6px 10px;font-size:.85rem;border:1px solid var(--line);border-radius:999px;background:transparent;color:var(--text);cursor:pointer}
    .tab-btn.active{background:#0b2448;border-color:#28518c;color:#bfdbfe}
    .tab-pane{display:none;padding:10px 12px}
    .tab-pane.active{display:block}
    .pane-head{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-bottom:8px}
    .search{flex:1}
    .search input{width:100%;padding:8px 10px;border-radius:10px;border:1px solid var(--line);background:#0c1630;color:var(--text)}
    .counter{font-size:.8rem;color:var(--muted);padding:2px 8px;border:1px solid var(--line);border-radius:999px}
    .list{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:8px;max-height:58vh;overflow:auto;padding-bottom:4px}
    @media (max-width: 1100px){ .list{grid-template-columns:repeat(2,minmax(0,1fr))} }
    @media (max-width: 560px){ .list{grid-template-columns:1fr} }

    .item{display:flex;gap:8px;align-items:center;padding:8px;border:1px solid var(--line);border-radius:10px;background:#0d1a33}
    .item input{width:16px;height:16px;accent-color:var(--accent)}
    .group-note{padding:8px 12px;border-top:1px solid var(--line);font-size:.85rem;color:var(--muted)}

    /* Right: Deck Math (prominent) */
    .deckmath{position:sticky;top:12px}
    .hero{background:radial-gradient(1200px 300px at 50% -100%, #183054, transparent), var(--panel);
          border:1px solid #2a3c5c;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .hero h2{margin:0;padding:12px 14px;border-bottom:1px solid #1f2c45;font-size:1rem;color:#c7d2fe;display:flex;align-items:center;gap:8px}
    .pill{font-size:.72rem;padding:2px 8px;border-radius:999px;border:1px solid #2c3f61;background:#11203c;color:#c7d2fe}
    .stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:12px}
    .stat{background:#0c1831;border:1px solid #203257;border-radius:12px;padding:10px 12px}
    .stat .k{font-size:.8rem;color:#9fb2d8}
    .stat .v{font-weight:800;font-size:1.6rem;line-height:1.2;margin-top:4px}
    .stat.primary{border-color:#3663a9;background:#0a1d3c}
    .stat.primary .v{font-size:1.9rem;color:#fef08a}
    .legend{display:grid;gap:6px;padding:0 12px 12px}
    .legend .row{font-size:.86rem;color:#c1c8da;display:flex;gap:6px;align-items:flex-start}
    .dot{width:10px;height:10px;border-radius:50%;display:inline-block;margin-top:6px}
    .d-corrupt{background:#fed7aa} /* pale orange */
    .d-outcast{background:#fef9c3} /* pale yellow */
    .d-dup{background:#bbf7d0}     /* pale green */
    .d-good{background:#e9d5ff}    /* pale purple */
    .d-evil{background:#f87171}    /* red */
    .assumptions{border-top:1px solid #1f2c45;padding:10px 12px;color:#a5b4fc;font-size:.86rem}

    /* Tiny banner strip */
    .strip{display:flex;gap:10px;flex-wrap:wrap;padding:8px 12px;border-bottom:1px dashed var(--line);color:#cbd5e1;font-size:.85rem}
    .chip{border:1px solid var(--line);border-radius:999px;padding:3px 8px;background:#0e1b34}
  </style>
</head>
<body>
  <header>
    <h1>Demon Bluff – Deck Selector & Math (Tabbed)</h1>
  </header>

  <div class="wrap">
    <!-- LEFT: Character tabs -->
    <section class="card">
      <h2>Characters</h2>

      <div class="strip">
        <span class="chip" id="count-villagers">Villagers: 0</span>
        <span class="chip" id="count-outcasts">Outcasts: 0</span>
        <span class="chip" id="count-minions">Minions: 0</span>
        <span class="chip" id="count-demons">Demons: 0</span>
        <span class="chip" id="count-total">Total selected: 0</span>
      </div>

      <div class="tabs" id="tabs"></div>

      <div id="pane-villagers" class="tab-pane active">
        <div class="pane-head">
          <div class="search"><input type="text" placeholder="Search villagers…" data-search="villagers"></div>
          <span class="counter" id="sel-villagers">Selected: 0</span>
        </div>
        <div class="list" id="list-villagers"></div>
        <div class="group-note">Villagers may be legitimately duplicated by <strong>Shaman</strong> and <strong>Doppelganger</strong>.</div>
      </div>

      <div id="pane-outcasts" class="tab-pane">
        <div class="pane-head">
          <div class="search"><input type="text" placeholder="Search outcasts…" data-search="outcasts"></div>
          <span class="counter" id="sel-outcasts">Selected: 0</span>
        </div>
        <div class="list" id="list-outcasts"></div>
        <div class="group-note">Note: <strong>Drunk</strong> is inherently corrupted. <strong>Puppet</strong> is <em>not</em> an outcast.</div>
      </div>

      <div id="pane-minions" class="tab-pane">
        <div class="pane-head">
          <div class="search"><input type="text" placeholder="Search minions…" data-search="minions"></div>
          <span class="counter" id="sel-minions">Selected: 0</span>
        </div>
        <div class="list" id="list-minions"></div>
        <div class="group-note"><strong>Puppeteer</strong> may create a <strong>Puppet</strong> (evil, truthful) if it has a villager neighbor.</div>
      </div>

      <div id="pane-demons" class="tab-pane">
        <div class="pane-head">
          <div class="search"><input type="text" placeholder="Search demons…" data-search="demons"></div>
          <span class="counter" id="sel-demons">Selected: 0</span>
        </div>
        <div class="list" id="list-demons"></div>
        <div class="group-note"><strong>Pooka</strong> corrupts neighbors; <strong>Lilis</strong> adds a kill timer; <strong>Baa</strong> adds a fake outcast to the deck.</div>
      </div>
    </section>

    <!-- RIGHT: Big, prominent Deck Math -->
    <aside class="deckmath">
      <div class="hero">
        <h2>Deck Math <span class="pill">live</span></h2>
        <div class="stats">
          <div class="stat primary">
            <div class="k">Max evils to kill</div>
            <div class="v" id="stat-evils">0</div>
          </div>
          <div class="stat">
            <div class="k">Max corrupted villagers <small>(excl. Drunk)</small></div>
            <div class="v" id="stat-corrupt-villagers">0</div>
          </div>
          <div class="stat">
            <div class="k">Total corrupted entities <small>(incl. Drunk)</small></div>
            <div class="v" id="stat-corrupt-total">0</div>
          </div>
          <div class="stat">
            <div class="k">Max outcasts in play</div>
            <div class="v" id="stat-outcasts">0</div>
          </div>
          <div class="stat">
            <div class="k">Legit duplicate claims budget</div>
            <div class="v" id="stat-duplicates">0</div>
          </div>
        </div>

        <div class="legend">
          <div class="row"><span class="dot d-evil"></span> Evils = selected Minions + selected Demons <strong>+ 1 if Puppeteer (Puppet created)</strong>.</div>
          <div class="row"><span class="dot d-corrupt"></span> Corruption sources: Plague Doctor (+1), Poisoner (+1), Pooka (+2).</div>
          <div class="row"><span class="dot d-outcast"></span> Outcasts = selected outcasts <strong>+1 if Counsellor</strong>, <strong>+1 if Baa</strong>. Puppet is not an outcast.</div>
          <div class="row"><span class="dot d-dup"></span> Duplicate claims allowed: <strong>+1 Shaman</strong>, <strong>+1 Doppelganger</strong>.</div>
        </div>

        <div class="assumptions">
          Puppet is <em>evil and truthful</em>; counts toward evils only if Puppeteer has a villager neighbor (max 1 Puppet).
        </div>
      </div>
    </aside>
  </div>

  <script>
    // ------------------------------ DATA --------------------------------------
    const DATA = {
      villagers: [
        "Alchemist","Architect","Baker","Bard","Bishop","Confessor","Dreamer","Druid",
        "Empress","Enlightened","Fortune Teller","Gemcrafter","Hunter","Jester","Judge",
        "Knight","Knitter","Lover","Medium","Oracle","Poet","Scout","Slayer","Witness"
      ],
      outcasts: [
        "Drunk","Wretch","Bombardier","Doppelganger","Plague Doctor"
      ],
      minions: [
        "Minion","Twin Minion","Counsellor","Witch","Poisoner","Shaman","Puppeteer"
      ],
      demons: [
        "Baa","Pooka","Lilis"
      ],
    };

    // ------------------------------ STATE -------------------------------------
    const state = {
      selected: new Set(),
      counts: {
        villagers: 0, outcasts: 0, minions: 0, demons: 0, total: 0
      }
    };

    // ----------------------------- TABS ---------------------------------------
    const tabDefs = [
      {key:"villagers", label:"Villagers"},
      {key:"outcasts",  label:"Outcasts"},
      {key:"minions",   label:"Minions"},
      {key:"demons",    label:"Demons"},
    ];

    const tabsEl = document.getElementById('tabs');
    function buildTabs(){
      tabDefs.forEach((t, idx)=>{
        const btn = document.createElement('button');
        btn.className = 'tab-btn' + (idx===0?' active':'');
        btn.dataset.tab = t.key;
        btn.textContent = t.label;
        btn.addEventListener('click', ()=>{
          document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          document.querySelectorAll('.tab-pane').forEach(p=>p.classList.remove('active'));
          document.getElementById('pane-'+t.key).classList.add('active');
        });
        tabsEl.appendChild(btn);
      });
    }
    buildTabs();

    // ------------------------ LIST RENDER + SEARCH ----------------------------
    function renderList(containerId, listKey){
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      DATA[listKey].forEach(name=>{
        const id = `cb-${name.replace(/\s+/g,'-').toLowerCase()}`;
        const label = document.createElement('label');
        label.className = 'item';
        const cb = document.createElement('input');
        cb.type = 'checkbox'; cb.id = id; cb.checked = state.selected.has(name);
        cb.addEventListener('change', ()=>{
          if (cb.checked) state.selected.add(name); else state.selected.delete(name);
          updateCounts();
          updateStats();
        });
        const span = document.createElement('span'); span.textContent = name;
        label.appendChild(cb); label.appendChild(span);
        container.appendChild(label);
      });
    }

    function hookSearch(){
      document.querySelectorAll('input[data-search]').forEach(inp=>{
        inp.addEventListener('input', ()=>{
          const key = inp.dataset.search;
          const q = inp.value.trim().toLowerCase();
          const listEl = document.getElementById('list-'+key);
          [...listEl.children].forEach(row=>{
            const name = row.querySelector('span').textContent.toLowerCase();
            row.style.display = name.includes(q) ? '' : 'none';
          });
        });
      });
    }

    // initial render
    renderList('list-villagers','villagers');
    renderList('list-outcasts','outcasts');
    renderList('list-minions','minions');
    renderList('list-demons','demons');
    hookSearch();

    // ------------------------------- MATH -------------------------------------
    function calcDuplicateBudget(sel){
      let budget = 0;
      if (sel.has("Shaman")) budget += 1;
      if (sel.has("Doppelganger")) budget += 1;
      return budget;
    }

    function calcCorruptionCapacity(sel){
      let cap = 0;
      if (sel.has("Plague Doctor")) cap += 1;
      if (sel.has("Poisoner")) cap += 1;
      if (sel.has("Pooka")) cap += 2;
      return cap;
    }

    function countDrunks(sel){ return sel.has("Drunk") ? 1 : 0; }

    function calcOutcastsMax(sel){
      // Start with explicitly selected outcasts
      let base = 0;
      for (const x of sel) if (DATA.outcasts.includes(x)) base += 1;
      // Adds:
      if (sel.has("Counsellor")) base += 1; // adds an outcast
      if (sel.has("Baa")) base += 1;        // fake outcast added to deck
      // NOTE: Puppet is NOT an outcast → do not add for Puppeteer
      return base;
    }

    function calcEvilsMax(sel){
      // Evils = selected minions + selected demons + 1 if Puppeteer (Puppet might be created)
      let evils = 0;
      for (const x of sel){
        if (DATA.minions.includes(x) || DATA.demons.includes(x)) evils += 1;
      }
      if (sel.has("Puppeteer")) evils += 1; // potential Puppet (requires villager neighbor)
      return evils;
    }

    // ------------------------- COUNTS + STATS UI ------------------------------
    function updateCounts(){
      const sel = state.selected;
      state.counts.villagers = [...sel].filter(x=>DATA.villagers.includes(x)).length;
      state.counts.outcasts  = [...sel].filter(x=>DATA.outcasts.includes(x)).length;
      state.counts.minions   = [...sel].filter(x=>DATA.minions.includes(x)).length;
      state.counts.demons    = [...sel].filter(x=>DATA.demons.includes(x)).length;
      state.counts.total     = sel.size;

      document.getElementById('count-villagers').textContent = `Villagers: ${state.counts.villagers}`;
      document.getElementById('count-outcasts').textContent  = `Outcasts: ${state.counts.outcasts}`;
      document.getElementById('count-minions').textContent   = `Minions: ${state.counts.minions}`;
      document.getElementById('count-demons').textContent    = `Demons: ${state.counts.demons}`;
      document.getElementById('count-total').textContent     = `Total selected: ${state.counts.total}`;

      document.getElementById('sel-villagers').textContent = `Selected: ${state.counts.villagers}`;
      document.getElementById('sel-outcasts').textContent  = `Selected: ${state.counts.outcasts}`;
      document.getElementById('sel-minions').textContent   = `Selected: ${state.counts.minions}`;
      document.getElementById('sel-demons').textContent    = `Selected: ${state.counts.demons}`;
    }

    function updateStats(){
      const sel = state.selected;
      const corruptVillagers = calcCorruptionCapacity(sel);
      const drunks = countDrunks(sel);
      const outcastsMax = calcOutcastsMax(sel);
      const dupBudget = calcDuplicateBudget(sel);
      const evilsMax = calcEvilsMax(sel);

      document.getElementById('stat-corrupt-villagers').textContent = corruptVillagers;
      document.getElementById('stat-corrupt-total').textContent = corruptVillagers + drunks;
      document.getElementById('stat-outcasts').textContent = outcastsMax;
      document.getElementById('stat-duplicates').textContent = dupBudget;
      document.getElementById('stat-evils').textContent = evilsMax;
    }

    // initialize counters
    updateCounts();
    updateStats();
  </script>
</body>
</html>
